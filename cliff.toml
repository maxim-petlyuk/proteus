# =============================================================================
# git-cliff configuration for Proteus
# Generates release notes with categorized sections
# =============================================================================

[changelog]
# Header appears at the top of the full CHANGELOG.md file
header = """
# Changelog

All notable changes to Proteus will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/),
and this project adheres to [Semantic Versioning](https://semver.org/).

"""

# Template for changelog body - produces Retrofit-style output
body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") | trim_start_matches(pat="proteus-core-") | trim_start_matches(pat="proteus-firebase-") | trim_start_matches(pat="proteus-ui-") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [Unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}

**{{ group }}**
{% for commit in commits %}
- {% if commit.scope %}**{{ commit.scope }}:** {% endif %}\
{{ commit.message | upper_first }}{% if commit.breaking %} ⚠️{% endif %}\
{% endfor %}\
{% endfor %}

"""

trim = true

footer = """
---
*Generated by [git-cliff](https://git-cliff.org/)*
"""

[git]
# Parse commits according to Conventional Commits spec
conventional_commits = true

filter_unconventional = true
split_commits = false

# Commit parsers - maps types to display groups
commit_parsers = [
    # Breaking changes get special treatment
    { message = "^.*!:", group = "⚠️ Breaking Changes" },
    { body = "BREAKING CHANGE", group = "⚠️ Breaking Changes" },

    # Standard type mappings
    { message = "^feat", group = "New" },
    { message = "^fix", group = "Fixed" },
    { message = "^perf", group = "Performance" },
    { message = "^refactor", group = "Changed" },

    # Hidden types
    { message = "^doc", skip = true },
    { message = "^docs", skip = true },
    { message = "^test", skip = true },
    { message = "^style", skip = true },
    { message = "^chore", skip = true },
    { message = "^ci", skip = true },
    { message = "^build", skip = true },
]

protect_breaking_commits = true

# Tag pattern matches both module tags and BOM tags
# Module: proteus-core-v1.0.0, proteus-firebase-v1.0.0, proteus-ui-v1.0.0
# BOM: v1.0.0
tag_pattern = "(proteus-(core|firebase|ui)-)?v[0-9]+\\.[0-9]+\\.[0-9]+"

sort_commits = "newest"
filter_commits = true

# Clean up commit messages
commit_preprocessors = [
    { pattern = "\\s*\\(#\\d+\\)$", replace = "" },
    { pattern = "\\s+$", replace = "" },
]
